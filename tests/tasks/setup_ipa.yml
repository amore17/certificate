---
- name: install role from rpm
  package:
    name: ansible-freeipa
  delegate_to: 127.0.0.1
  become: false

- name: Ensure nss package is up-to-date
  package:
    name: nss
    state: latest
  when: ansible_facts.os_family == "RedHat"

- name: Ensure nss package is up-to-date
  package:
    name: nss
    state: latest
  when: ansible_facts.os_family == "RedHat"

- name: Set hostname
  hostname:
    name: ipaserver.test.local

- include_role:
    name: ipaserver
  vars:
    ipaserver_setup_dns: yes
    ipaserver_auto_forwarders: yes
    ipaadmin_password: SomeADMINpassword
    ipadm_password: SomeDMpassword
    ipaserver_domain: test.local
    ipaserver_realm: TEST.LOCAL
    ipaserver_no_dnssec_validation: yes
